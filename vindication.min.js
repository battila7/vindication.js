var _=require("isa.js"),Vindication={requiredFn:function(n,u){return!u||n},minlengthFn:function(n,u){return n&&n.length>=u},maxlengthFn:function(n,u){return!n||n.length<=u},lengthFn:function(n,u){return _.isString(u)&&(u=JSON.parse(u)),this.minlengthFn(n,u[0])&&this.maxlengthFn(n,u[1])},elementFn:function(n,u){return Array.isArray(u)&&-1!==u.indexOf(n)},minFn:function(n,u){return n&&Number(n)>=u},maxFn:function(n,u){return n&&Number(n)<=u},rangeFn:function(n,u){return n&&n>=u[0]&&n<=u[1]},patternFn:function(n,u){return new RegExp(u).test(n)},equaltoFn:function(n,u){return n===u},notblank:function(n,u){return!u||this.minlengthFn(n,1)},beforeFn:function(n,u){return this.maxFn(n.getTime?n.getTime():n,u.getTime?u.getTime():u)},afterFn:function(n,u){return this.minFn(n.getTime?n.getTime():n,u.getTime?u.getTime():u)},typeFn:function(n,u){var e;switch(u){case"number":e=/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/;break;case"digits":e=/^\d+$/;break;case"integer":e=/^-?\d+$/;break;case"alphanum":e=/^\w+$/;break;case"email":e=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i;break;case"url":e=new RegExp("(https?:\\/\\/)?(www\\.)?[-a-zA-Z0-9@:%._\\+~#=]{2,256}\\.[a-z]{2,4}\\b([-a-zA-Z0-9@:%_\\+.~#?&//=]*)","i");break;case"dateIso":e=/^(\d{4})\D?(0[1-9]|1[0-2])\D?([12]\d|0[1-9]|3[01])$/;break;case"phone":e=/^((\+\d{1,3}(-| )?\(?\d\)?(-| )?\d{1,5})|(\(?\d{2,6}\)?))(-| )?(\d{3,4})(-| )?(\d{4})(( x| ext)\d{1,5}){0,1}$/;break;default:return!1}return n?e.test(n):!1},checkConstraints:function(n,u,e,r,t){var F=this;if(_.isFunction(e)){if(!e.call(r,u))return"This value seems to be invalid: "+u}else{if(_.isArray(e)){var i=[];return e.forEach(function(e){var a=F.checkConstraints(n,u,e,r,t);a&&i.push(a)}),0===i.length?null:i[0]}if(t.ignores)for(var a=0;a<t.ignores.length;++a)if(u[t.ignores[a]])return null;if(e.condition&&!e.condition.call(r,u))return null;if(("undefined"==typeof u||""===u||null===u)&&!e.required)return null;for(var s in e)if("message"!==s&&"condition"!==s){var c=e[s];if(!c.condition||c.condition.call(r,u)){var o=F[s+"Fn"](u,c.params||c)?null:(e.message||"This value seems to be invalid:")+" "+u;if(o)return o}}}return null},walk:function(n,u,e,r,t){var F,i=this;if(_.isString(u))return i.checkConstraints(n,u,e,r,t);if(_.isBoolean(u))return i.checkConstraints(n,u,e,r,t);if(_.isNumber(u))return i.checkConstraints(n,u,e,r,t);if(_.isDate(u))return i.checkConstraints(n,u,e,r,t);if(_.isRegExp(u))return null;if(Array.isArray(u))return F=[],u.forEach(function(u){var t=i.walk(n,u,e,r);t&&F.push(t)}),0===F.length?null:F;if(_.isFunction(u))return i.checkConstraints(n,u.call(r),e,r,t);if(_.isObject(u)){if(_.isFunction(e))return i.checkConstraints(n,u,e,r,t);F={};for(var a in u)if(a&&e[a]){var s=u[a],c=i.walk(n,s,e[a],r);c&&(F[a]=c)}return 0===Object.keys(F).length?null:F}return null}};module.exports={version:"3.0.2",validate:function(n,u,e,r){return Vindication.walk(n,n,u||{},e||n,r||{})},validateAll:function(n,u,e,r){if(!Array.isArray(n))return this.validate(n,u,e);var t=[];return n.forEach(function(n){t.push(Vindication.walk(n,n,u||{},e||n,r||{}))}),t}};