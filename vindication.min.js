var _=require("lodash"),Vindication={requiredFn:function(n,F){return!F||n},minlengthFn:function(n,F){return n&&n.length>=F},maxlengthFn:function(n,F){return!n||n.length<=F},lengthFn:function(n,F){return _.isString(F)&&(F=JSON.parse(F)),this.minlengthFn(n,F[0])&&this.maxlengthFn(n,F[1])},elementFn:function(n,F){return _.isArray(F)&&-1!==F.indexOf(n)},minFn:function(n,F){return n&&Number(n)>=F},maxFn:function(n,F){return n&&Number(n)<=F},rangeFn:function(n,F){return n&&n>=F[0]&&n<=F[1]},patternFn:function(n,F){return new RegExp(F).test(n)},equaltoFn:function(n,F){return n===F},notblank:function(n,F){return!F||this.minlengthFn(n,1)},beforeFn:function(n,F){return this.maxFn(n.getTime?n.getTime():n,F.getTime?F.getTime():F)},afterFn:function(n,F){return this.minFn(n.getTime?n.getTime():n,F.getTime?F.getTime():F)},typeFn:function(n,F){var u;switch(F){case"number":u=/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/;break;case"digits":u=/^\d+$/;break;case"integer":u=/^-?\d+$/;break;case"alphanum":u=/^\w+$/;break;case"email":u=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i;break;case"url":u=new RegExp("(https?:\\/\\/)?(www\\.)?[-a-zA-Z0-9@:%._\\+~#=]{2,256}\\.[a-z]{2,4}\\b([-a-zA-Z0-9@:%_\\+.~#?&//=]*)","i");break;case"dateIso":u=/^(\d{4})\D?(0[1-9]|1[0-2])\D?([12]\d|0[1-9]|3[01])$/;break;case"phone":u=/^((\+\d{1,3}(-| )?\(?\d\)?(-| )?\d{1,5})|(\(?\d{2,6}\)?))(-| )?(\d{3,4})(-| )?(\d{4})(( x| ext)\d{1,5}){0,1}$/;break;default:return!1}return n?u.test(n):!1},checkConstraints:function(n,F,u,e){var t=this;if(_.isFunction(u)){if(!u.call(e,F))return"This value seems to be invalid: "+F}else for(var i in u)if("message"!==i){var a=u[i];if(a.params&&a.condition){if(a.condition(n)){var r=t[i+"Fn"](F,a.params)?null:(u.message||"This value seems to be invalid:")+" "+F;if(r)return r}}else{var s=t[i+"Fn"](F,a)?null:(u.message||"This value seems to be invalid:")+" "+F;if(s)return s}}},walk:function(n,F,u,e){var t,i=this;return _.isString(F)?i.checkConstraints(n,F,u,e):_.isBoolean(F)?i.checkConstraints(n,F,u,e):_.isNumber(F)?i.checkConstraints(n,F,u,e):_.isDate(F)?i.checkConstraints(n,F,u,e):_.isRegExp(F)?null:_.isArray(F)?(t=[],F.forEach(function(F){var a=i.walk(n,F,u,e);a&&t.push(a)}),0===t.length?null:t):_.isFunction(F)?i.checkConstraints(n,F.call(e),u,e):_.isObject(F)?_.isFunction(u)?i.checkConstraints(n,F,u,e):(t={},_.forEach(F,function(F,a){if(a&&u[a]){var r=i.walk(n,F,u[a],e);r&&(t[a]=r)}}),0===_.keys(t).length?null:t):null}};module.exports={version:"3.0.2",validate:function(n,F,u){return Vindication.walk(n,n,F||{},u||n)},validateAll:function(n,F,u){if(!_.isArray(n))return this.validate(n,F,u);var e=[];return n.forEach(function(n){e.push(Vindication.walk(n,n,F||{},u||n))}),e}};