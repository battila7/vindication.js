var _=require("lodash"),Vindication={requiredFn:function(n,F){return!F||n},minlengthFn:function(n,F){return n&&n.length>=F},maxlengthFn:function(n,F){return!n||n.length<=F},lengthFn:function(n,F){return _.isString(F)&&(F=JSON.parse(F)),this.minlengthFn(n,F[0])&&this.maxlengthFn(n,F[1])},elementFn:function(n,F){return _.isArray(F)&&-1!==F.indexOf(n)},minFn:function(n,F){return n&&Number(n)>=F},maxFn:function(n,F){return n&&Number(n)<=F},rangeFn:function(n,F){return n&&n>=F[0]&&n<=F[1]},patternFn:function(n,F){return new RegExp(F).test(n)},equaltoFn:function(n,F){return n===F},notblank:function(n,F){return!F||this.minlengthFn(n,1)},beforeFn:function(n,F){return this.maxFn(n.getTime?n.getTime():n,F.getTime?F.getTime():F)},afterFn:function(n,F){return this.minFn(n.getTime?n.getTime():n,F.getTime?F.getTime():F)},typeFn:function(n,F){var e;switch(F){case"number":e=/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/;break;case"digits":e=/^\d+$/;break;case"integer":e=/^-?\d+$/;break;case"alphanum":e=/^\w+$/;break;case"email":e=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i;break;case"url":e=new RegExp("(https?:\\/\\/)?(www\\.)?[-a-zA-Z0-9@:%._\\+~#=]{2,256}\\.[a-z]{2,4}\\b([-a-zA-Z0-9@:%_\\+.~#?&//=]*)","i");break;case"dateIso":e=/^(\d{4})\D?(0[1-9]|1[0-2])\D?([12]\d|0[1-9]|3[01])$/;break;case"phone":e=/^((\+\d{1,3}(-| )?\(?\d\)?(-| )?\d{1,5})|(\(?\d{2,6}\)?))(-| )?(\d{3,4})(-| )?(\d{4})(( x| ext)\d{1,5}){0,1}$/;break;default:return!1}return""!==n?e.test(n):!1},checkConstraints:function(n,F,e,u){var t=this;if(_.isFunction(e)){if(!e.call(u,F))return"This value seems to be invalid: "+F}else for(var i in e)if("message"!==i){var a=e[i];if(a.params&&a.condition){if(a.condition(n)){var r=t[i+"Fn"](F,a.params)?null:(e.message||"This value seems to be invalid:")+" "+F;if(r)return r}}else{var s=t[i+"Fn"](F,a)?null:(e.message||"This value seems to be invalid:")+" "+F;if(s)return s}}},walk:function(n,F,e,u){var t,i=this;return _.isString(F)?i.checkConstraints(n,F,e,u):_.isBoolean(F)?i.checkConstraints(n,F,e,u):_.isNumber(F)?i.checkConstraints(n,F,e,u):_.isDate(F)?i.checkConstraints(n,F,e,u):_.isRegExp(F)?null:_.isArray(F)?(t=[],F.forEach(function(F){var a=i.walk(n,F,e,u);a&&t.push(a)}),0===t.length?null:t):_.isFunction(F)?i.checkConstraints(n,F.call(u),e,u):_.isObject(F)?_.isFunction(e)?i.checkConstraints(n,F,e,u):(t={},_.forEach(F,function(a,r){if(r&&F[r]&&e[r]){var s=i.walk(n,F[r],e[r],u);s&&(t[r]=s)}}),0===_.keys(t).length?null:t):void 0}};module.exports={version:"3.0.0",validate:function(n,F,e){return Vindication.walk(n||{},n||{},F||{},e||this)},validateAll:function(n,F,e){if(!_.isArray(n))return this.validate(n,F,e);var u=[];return n.forEach(function(n){u.push(Vindication.walk(n||{},n||{},F||{},e||this))}),u}};