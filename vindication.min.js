var _=require("isa.js"),Vindication={requiredFn:function(n,u){return!u||n},minlengthFn:function(n,u){return n&&n.length>=u},maxlengthFn:function(n,u){return!n||n.length<=u},lengthFn:function(n,u){return _.isString(u)&&(u=JSON.parse(u)),this.minlengthFn(n,u[0])&&this.maxlengthFn(n,u[1])},elementFn:function(n,u){return Array.isArray(u)&&-1!==u.indexOf(n)},minFn:function(n,u){return n&&Number(n)>=u},maxFn:function(n,u){return n&&Number(n)<=u},rangeFn:function(n,u){return n&&n>=u[0]&&n<=u[1]},patternFn:function(n,u){return new RegExp(u).test(n)},equaltoFn:function(n,u){return n===u},notblank:function(n,u){return!u||this.minlengthFn(n,1)},beforeFn:function(n,u){return this.maxFn(n.getTime?n.getTime():n,u.getTime?u.getTime():u)},afterFn:function(n,u){return this.minFn(n.getTime?n.getTime():n,u.getTime?u.getTime():u)},typeFn:function(n,u){var e;switch(u){case"number":e=/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/;break;case"digits":e=/^\d+$/;break;case"integer":e=/^-?\d+$/;break;case"alphanum":e=/^\w+$/;break;case"email":e=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i;break;case"url":e=new RegExp("(https?:\\/\\/)?(www\\.)?[-a-zA-Z0-9@:%._\\+~#=]{2,256}\\.[a-z]{2,4}\\b([-a-zA-Z0-9@:%_\\+.~#?&//=]*)","i");break;case"dateIso":e=/^(\d{4})\D?(0[1-9]|1[0-2])\D?([12]\d|0[1-9]|3[01])$/;break;case"phone":e=/^((\+\d{1,3}(-| )?\(?\d\)?(-| )?\d{1,5})|(\(?\d{2,6}\)?))(-| )?(\d{3,4})(-| )?(\d{4})(( x| ext)\d{1,5}){0,1}$/;break;default:return!1}return n?e.test(n):!1},checkConstraints:function(n,u,e,F){var r=this;if(_.isFunction(e)){if(!e.call(F,u))return"This value seems to be invalid: "+u}else{if(_.isArray(e)){var t=[];return e.forEach(function(e){var i=r.checkConstraints(n,u,e,F);i&&t.push(i)}),0===t.length?null:t[0]}for(var i in e)if("message"!==i){var a=e[i];if(a.params&&a.condition){if(a.condition.call(F,u)){var s=r[i+"Fn"](u,a.params)?null:(e.message||"This value seems to be invalid:")+" "+u;if(s)return s}}else{var c=r[i+"Fn"](u,a)?null:(e.message||"This value seems to be invalid:")+" "+u;if(c)return c}}}return null},walk:function(n,u,e,F){var r,t=this;if(_.isString(u))return t.checkConstraints(n,u,e,F);if(_.isBoolean(u))return t.checkConstraints(n,u,e,F);if(_.isNumber(u))return t.checkConstraints(n,u,e,F);if(_.isDate(u))return t.checkConstraints(n,u,e,F);if(_.isRegExp(u))return null;if(Array.isArray(u))return r=[],u.forEach(function(u){var i=t.walk(n,u,e,F);i&&r.push(i)}),0===r.length?null:r;if(_.isFunction(u))return t.checkConstraints(n,u.call(F),e,F);if(_.isObject(u)){if(_.isFunction(e))return t.checkConstraints(n,u,e,F);r={};for(var i in u)if(i&&e[i]){var a=u[i],s=t.walk(n,a,e[i],F);s&&(r[i]=s)}return 0===Object.keys(r).length?null:r}return null}};module.exports={version:"3.0.2",validate:function(n,u,e){return Vindication.walk(n,n,u||{},e||n)},validateAll:function(n,u,e){if(!Array.isArray(n))return this.validate(n,u,e);var F=[];return n.forEach(function(n){F.push(Vindication.walk(n,n,u||{},e||n))}),F}};